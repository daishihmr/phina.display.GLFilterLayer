<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width,height=device-height,user-scalable=no,initial-scale=1,maximum-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta charset="UTF-8">
</head>

<body>
  <canvas id="app"></canvas>
  <script src="https://rawgit.com/phinajs/phina.js/develop/build/phina.js"></script>
  <script src="../../phigl.js/build/phigl.js"></script>
  <script src="../build/phina.glfilter.js"></script>
  <script>
  phina.globalize();

  phina.main(() => {
    const app = GameApp({
      domElement: document.querySelector("#app"),
      startLabel: "main",
      width: 768,
      height: 1024,
      // fit: false,
      fps: 60,
      assets: {
        image: {
          "bg": "bg.jpg",
          "cureyell": "cureyell.png",
        },
      },
    }).run();

    app.enableStats();
  });

  phina.define("MainScene", {
    superClass: "DisplayScene",

    init: function() {
      this.superInit({
        width: 768,
        height: 1024,
        backgroundColor: "black",
      });

      const layerAll = GLFilterLayer({
        width: 768,
        height: 1024,
        originX: 0,
        originY: 0,
        x: 0,
        y: 0,
        quarity: 1 / 4,
      });

      const bg = Sprite("bg")
        .setScale(2)
        .setPosition(this.gridX.center(), this.gridY.center())
        .addChildTo(layerAll);

      const cureyell = Sprite("cureyell")
        .setPosition(this.gridX.center(), this.gridY.center())
        .addChildTo(layerAll);

      layerAll.addChildTo(this);

      RectangleShape({
        width: 768,
        height: 1024,
        padding: 0,
        fill: null,
        stroke: "red",
        strokeWidth: 5,
      }).setPosition(0, 0).setOrigin(0, 0).addChildTo(this);

      const bloomNode = BloomNode().addTo(layerAll);
      bloomNode.minBright = 1.0;
      // Tweener().attachTo(this)
      //   .clear()
      //   .wait(1000)
      //   .call(() => {
      //     layerAll.enableGL = !layerAll.enableGL;
      //   })
      //   .setLoop(true);

      const zb = ZoomBlurNode().addTo(layerAll);
      zb.x = 0.5;
      zb.y = 0.12;
      // zb.strength = 10;

      this.on("enterframe", (e) => {
        const t = e.app.frame;
        bloomNode.minBright = 1.0 - Math.abs(Math.sin(t * 0.02));
        // zb.uniformValues["strength"] = Math.abs(Math.sin(t * 0.02)) * 5;
      })
    },
  });
  </script>
</body>

</html>